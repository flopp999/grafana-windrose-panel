{"version":3,"sources":["../src/wind_rose.js"],"names":["angular","$","moment","_","d3","module","directive","$rootScope","timeSrv","Rainbow","restrict","template","link","scope","elem","ctrl","panel","options","copy","windRoseOptions","strokes","ticks","randomColors","ticksUpdated","radius","pointR","containerW","containerH","bgId","guid","data","preparedData","dataDirections","dataVelocities","extraData","peaksData","svg","scale_container","points_container","chart_container","axis_container","circles_container","compass_rose_container","percents_scale_container","curve_container","points_scale","chart_scale","colored_scale","maxV","line_tooltip_container","line_tooltip","div","select","append","attr","style","init","initSvg","buildAxis","buildScaleContainer","defineBg","defineTooltip","setTimeout","chart","find","aspect","width","height","container","parent","panelEl","closest","panelElW","cb","targetWidth","Math","round","$watch","window","on","trigger","bgSize","labelCompassRoseSize","num","ceil","delta","log2","bgDefEl","selectAll","enter","exit","remove","d","imgEl","coords","mouse","hyp","sqrt","alpha","asin","PI","tooltip_points","chain","map","item","without","value","pointEl","point_radius","x","y","x2","y2","html","each","point","color","alias","v","time","event","pageX","pageY","lineX","axisName","text","setAxisName","titleEl","buildChartScale","numOfBlocks","chartColors","i","y1","getColorAtPoint","push","chartScaleEl","buildChartScaleLabels","step","percents","yOffset","percent","chartLabelEl","buildScale","scale","createStrokes","length","currentYPositive","currentYNegative","x1","currentTick","indexOf","logBase","match","minV","log","abs","strokesEl","buildColoredScale","dotColors","speeds","speed_main","coloredScaleEl","buildColoredScaleLabels","gradientBasedOn","colorsObj","getColorsObj","title","Object","keys","direction","datapoints","minTime","maxTime","stepTime","format","colorsArr","toArray","minVal","min","maxVal","max","stepVal","coloredScaleLabelEl","coloredScaleTitleEl","buildR","r","circleEl","buildCircumferences","createR","current_r","buildChartCircumferences","buildPercentsScale","offset","parseInt","hypotenuse","sin","textAnchor","percentsScaleEl","togglePercents","showPercents","degree","axisFrequency","axis","betta","pi","val","cos","axisEl","buildStrokesLabels","labels","xCoord","yShift","createLabels","labelTicks","yCoordPositive","yCoordNegative","labelEl","buildPoints","points","wind_speed","wind_dir","extra","opacity","buildChart","arcEl","arc","startAngle","endAngle","buildExtraLines","lines_data","points_data","bars_data","lines","bars","lineFunc","line","interpolate","curveEl","curve","curveElPointsContainer","curveElPoints","curveElBarsContainer","curveElBars","line_width","sort","a","b","a_z","z_index","b_z","addCompassRoseAsBackground","compassRose","labelCompassRose","setCompassRoseOpacity","compassRoseOpacity","labelCompassRoseOpacity","styleAxisLabels","degrees","labelDegrees","cardinalCompass","labelCardinalCompass","intercardinalCompass","labelIntercardinalCompass","hardcoded_r","getAngleCoords","init_alpha","current_alpha","fontSize","compass","angle","axisStyleEl","setChartOpacity","chartOpacity","toggleWindRoseType","type","renderExtraLines","preparedSpeeds","windRoseType","peakTypeBar","peakTypeLine","peakTypePoints","peakTypeLineFill","peakTypeLineWidth","peakTypePointsRadius","overrides","seriesOverrides","res","directions","key","j","key_overrides","curvePointObj","isDefined","fill","linewidth","pointradius","zindex","split","assignIn","hide","speed_name","renderChart","numOfDirections","windSpeedStep","percentsPosition","totalPercents","velocities","velocitiesArray","numOfCircles","maxColorVal","floor","getMinMaxVelocity","segment","maxSegment","zeroR","maxPercentInScale","innerSegments","groupBy","angleOffset","startAngleInit","endAngleInit","innerR","outerR","innerSegment","innerSegmentOuterR","innerRadius","outerRadius","innerSegmentPercents","segmentPercents","percentsScale","renderPoints","alphaBlending","alphaBlendingMinOpacity","lastPointColor","new_points","filtredAngles","filtredVelocities","timeKeysArray","main_speed","minMaxTime","diffTime","prepared_main_speed","realMinMaxV","getColor","pointVal","pointMinVal","pointMaxVal","renderPointsPanel","prepareSpeeds","s4","random","toString","substring","colors","setSpectrumByArray","setNumberRange","colourAt","generateRandomColors","letters","colorBasedOnSpeed","speed","defaultMaxV","getMaxV","current_max","range","scaleStep","prepareData","trimDatapoints","createTimedIndex","colorKey","startIndex","endIndex","l","isNaN","parseFloat","slice","timedIndex","timeKey","dataValue","events","renderData","refresh","newVal","filter","chartColorFrom","chartColorTo","removeAttr"],"mappings":"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","file":"wind_rose.js","sourcesContent":["import angular from 'angular';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport d3 from './bower_components/d3/d3.js';\nimport './gradient';\n\nangular.module('grafana.directives').directive('grafanaWindRose', function($rootScope, timeSrv, Rainbow) {\n  return {\n    restrict: 'A',\n    template: '<div> </div>',\n    link: function(scope, elem) {\n      var ctrl = scope.ctrl;\n      var panel = ctrl.panel;\n      var options = angular.copy(panel.windRoseOptions);\n      var strokes = [];\n      var ticks = [];\n      var randomColors = [];\n      var ticksUpdated = null;\n      var radius = 300;\n      var pointR = 7;\n      var containerW = 1000;\n      var containerH = 720;\n      var bgId = guid();\n      var data,\n          preparedData,\n          dataDirections,\n          dataVelocities,\n          extraData,\n          peaksData,\n          svg,\n          scale_container,\n          points_container,\n          chart_container,\n          axis_container,\n          circles_container,\n          compass_rose_container,\n          percents_scale_container,\n          curve_container,\n          points_scale,\n          chart_scale,\n          colored_scale,\n          maxV,\n          line_tooltip_container,\n          line_tooltip;\n\n      var div = d3.select(\"body\").append('div')\n                  .attr('class', 'tooltip')\n                  .style('opacity', 0);\n\n      function init () {\n          initSvg();\n          buildAxis();\n          buildScaleContainer();\n      }\n\n      function initSvg () {\n          svg = d3.select(elem[0]).append('svg')\n                  .attr('id', 'chart')\n                  .attr('width', containerW)\n                  .attr('height', containerH)\n                  .attr('viewBox', '0 0 1000 720')\n                  .attr('preserveAspectRatio', 'xMidYMid meet')\n                  .append('g')\n                  .attr('transform', 'translate(480, 360)');\n\n          svg.style('display', 'none');\n\n          circles_container = svg.append('g')\n                                 .attr('class', 'circles_container');\n\n          axis_container = svg.append('g')\n                              .attr('class', 'axis_container');\n\n          compass_rose_container = svg.append('g')\n                                      .attr('class', 'compass_rose_container')\n                                      .style('fill', 'none');\n\n          percents_scale_container = svg.append('g')\n                                        .attr('class', 'percents_scale_container');\n\n          line_tooltip_container = svg.append('g')\n                                          .attr('class', 'line_tooltip_container');\n\n          line_tooltip = line_tooltip_container.append('line')\n                                                .attr('class', 'line_tooltip')\n                                                .style('stroke', '#f00')\n                                                .style('opacity', 0);\n\n          line_tooltip_container.append('circle')\n                                .attr('r', radius)\n                                .attr('cx', 0)\n                                .attr('cy', 0)\n                                .attr('opacity', 0)\n                                .attr('class', 'show_tooltip');\n\n          curve_container = svg.append('g')\n                               .attr('class', 'curve_container');\n\n          points_container = curve_container.append('g')\n                                            .attr('class', 'points_container sortable');\n\n          chart_container = svg.append('g')\n                               .attr('class', 'chart_container');\n\n          defineBg();\n          defineTooltip();\n\n          setTimeout(function () {\n              var chart = $(elem).find('#chart'),\n                  aspect = chart.width() / chart.height(),\n                  container = chart.parent();\n\n              var panelEl = chart.closest('.panel-container');\n              scope.panelElW = panelEl.height();\n\n              var cb = function() {\n                  var targetWidth = container.width();\n                  targetWidth = targetWidth > containerW ? containerW : targetWidth;\n                  chart.attr('width', targetWidth);\n                  chart.attr('height', Math.round(targetWidth / aspect));\n                  svg.style('display', 'block');\n              };\n\n              scope.$watch(function () {\n                scope.panelElW = panelEl.width();\n              });\n              scope.$watch('panelElW', cb);\n              $(window).on('resize', cb).trigger('resize');\n          }, 1000);\n      }\n\n      function defineBg () {\n          var bgSize = options.labelCompassRoseSize || 0.9;\n\n          var num = (1 - Math.ceil(bgSize * 5) / 5) * 10;\n          var delta = num == 0 ? 7 : 7 - (num - Math.log2(num));\n\n          bgSize *= (2 * radius);\n\n          var bgDefEl = svg.selectAll('defs').data([bgSize]);\n\n          bgDefEl.enter().append('defs');\n          bgDefEl.exit().remove();\n\n          bgDefEl.append('pattern')\n                  .attr('width', function (d) { return d; })\n                  .attr('height', function (d) { return d; })\n                  .attr('x', function (d) {\n                      return -1 * d/2 - delta;\n                  })\n                  .attr('y', function (d) { return -1 * d/2; })\n                  .attr(\"id\", bgId)\n                  .attr('patternUnits', 'userSpaceOnUse')\n                  .append(\"image\")\n                  .attr(\"xlink:href\", \"public/plugins/n-wind-rose-panel/img/windrose.svg\")\n                  .attr('width', function (d) { return d; })\n                  .attr('height', function (d) { return d; })\n                  .attr('x', 0)\n                  .attr('y', 0);\n\n          var imgEl = compass_rose_container.selectAll('circle').data([bgSize]);\n\n          imgEl.enter().append('circle');\n          imgEl.exit().remove();\n\n          imgEl.attr('r', function (d) { return d/2; })\n               .attr('x', function (d) { return -1 * d/2; })\n               .attr('y', function (d) { return -1 * d/2; })\n               .attr('class', 'bg_container');\n      }\n\n      function defineTooltip () {\n          svg.selectAll('.show_tooltip')\n            .on('mousemove', function (d) {\n              if (peaksData) {\n                  line_tooltip.style('opacity', 1);\n\n                  var coords = d3.mouse(this);\n                  var hyp = Math.sqrt(coords[0] * coords[0] + coords[1] * coords[1]);\n                  var alpha = Math.asin(coords[1]/ hyp) * 180 / Math.PI;\n                  if (coords[0] < 0) {\n                      alpha = 180 - alpha;\n                  }\n                  alpha += 90;\n                  alpha = Math.round(alpha);\n                  var tooltip_points = _.chain(peaksData).map(function (item) {\n                      return item['curve'][alpha] && !item['curve'][alpha]['hide'] ? item['curve'][alpha] : null;\n                  }).without(null).value();\n\n                  var pointEl = line_tooltip_container.selectAll('.point_tooltip')\n                                                      .data(tooltip_points);\n\n                  pointEl.enter().append('circle');\n                  pointEl.exit().remove();\n\n                  pointEl.attr('r', function (d) { return +d.point_radius + 3; })\n                          .attr('cx', function (d) { return d.x; })\n                          .attr('cy', function (d) { return d.y; })\n                          .attr('class', 'point_tooltip')\n                          .style('fill', '#fff')\n                          .style('stroke', '#f00');\n\n                  var x2 = radius * coords[0] / hyp;\n                  var y2 = Math.sqrt(radius * radius - x2 * x2);\n                  if (coords[1] < 0) {\n                      y2 *= -1;\n                  }\n                  line_tooltip.attr('x1', 0)\n                              .attr('x2', x2)\n                              .attr('y1', 0)\n                              .attr('y2', y2);\n                  //tooltip\n                  div.style('opacity', 1);\n\n                  var html = '<div class=\"degree\">' + alpha + '\\u00B0 </div>';\n                  _.each(tooltip_points, function (point) {\n                      html += '<div class=\"info-row\"><div class=\"colored_line\" style=\"background-color:' + point.color + '\"></div><span>' + point.alias + '</span><span class=\"point_v\">' + point.v + '</span>';\n                      if (point.time) {\n                          html += '<span class=\"point_time\">' + point.time + '</span>';\n                      }\n                      html += '</div>';\n                  });\n                  div.html(html)\n                    .style('left', (d3.event.pageX + 15) + 'px')\n                    .style('top', (d3.event.pageY - 38) + 'px');\n              }\n            })\n            .on('mouseout', function () {\n                line_tooltip.attr('x1', 0)\n                            .attr('x2', 0)\n                            .attr('y1', 0)\n                            .attr('y2', 0)\n                            .style('opacity', 0);\n\n                var pointEl = line_tooltip_container.selectAll('.point_tooltip')\n                                                    .data([]);\n\n                pointEl.enter().append('circle');\n                pointEl.exit().remove();\n\n                //tooltip\n                div.style('opacity', 0)\n                    .style('left', 0)\n                    .style('top', 0);\n            });\n      }\n\n      function buildScaleContainer () {\n          var lineX = 60;\n          var axisName = options.axisName;\n\n          scale_container = svg.append('g')\n                               .attr('class', 'scale_container')\n                               .attr('transform', 'translate(-460, 0)');\n\n          scale_container.append('text')\n                         .attr('x', -50)\n                         .attr('y', 0)\n                         .text(axisName)\n                         .attr('transform', 'rotate(270, 0, 0)')\n                         .attr('class', 'axis_title')\n                         .style('fill', '#fff');\n\n          points_scale = scale_container.append('g')\n                                        .attr('class', 'points_scale');\n\n          chart_scale = scale_container.append('g')\n                                       .attr('class', 'chart_scale');\n\n          colored_scale = svg.append('g')\n                             .attr('class', 'colored_scale')\n                             .attr('transform', 'translate(370, 0)');\n\n          points_scale.append('line')\n                      .attr('x1', lineX)\n                      .attr('y1', -1 * radius)\n                      .attr('x2', lineX)\n                      .attr('y2', radius)\n                      .style('stroke', '#fff')\n                      .style('stroke-width', '5px');\n      }\n\n      function setAxisName () {\n          var axisName = options.axisName;\n          var titleEl = scale_container.selectAll('.axis_title')\n                                        .data([axisName]);\n          titleEl.enter().append('text');\n          titleEl.exit().remove();\n\n          titleEl.attr('x', -50)\n                 .attr('y', 0)\n                 .text(function (d) { return d; })\n                 .attr('transform', 'rotate(270, 0, 0)')\n                 .attr('class', 'axis_title')\n                 .style('fill', '#fff');\n      }\n\n      function buildChartScale (numOfBlocks) {\n          var lineX = 20;\n          var chartColors = options.chartColors;\n          var d = [];\n          for (var i = 0; i <= numOfBlocks; i++) {\n              var y1 = radius - i * 2 * radius/(numOfBlocks + 1);\n              var y2 = y1 - 2 * radius/(numOfBlocks + 1);\n              var color = getColorAtPoint(i, 0, numOfBlocks, chartColors);\n              d.push({y1: y1, y2: y2, color: color});\n          }\n\n          var chartScaleEl = chart_scale.selectAll('.chart_block')\n                                        .data(d);\n\n          chartScaleEl.enter().append('line');\n          chartScaleEl.exit().remove();\n\n          chartScaleEl.attr('x1', lineX)\n                      .attr('y1', function(d) { return d.y1; })\n                      .attr('x2', lineX)\n                      .attr('y2', function(d) { return d.y2; })\n                      .attr('class', 'chart_block')\n                      .style('stroke', function (d) { return d.color; })\n                      .style('stroke-width', '12px');\n      }\n\n      function buildChartScaleLabels (step, numOfBlocks, percents) {\n          var x = 35;\n          var yOffset = 5;\n          var d = [];\n          for (var i = 0; i <= numOfBlocks + 1; i++) {\n              var y = radius - i * 2 * radius/(numOfBlocks + 1) + yOffset;\n              var percent = percents[i] || 0;\n              var text = Math.round(i * step * 10) / 10  + '  (' + percent + '%)';\n              d.push({y: y, text: text});\n          }\n\n          var chartLabelEl = chart_scale.selectAll('.chart_label')\n                                        .data(d);\n\n          chartLabelEl.enter().append('text');\n          chartLabelEl.exit().remove();\n\n          chartLabelEl.attr('x', x)\n                      .attr('y', function(d) { return d.y; })\n                      .attr('class', 'chart_label')\n                      .text(function (d) { return d.text; })\n                      .style('fill', '#fff')\n                      .style('font-size', '13px');\n      }\n\n      function buildScale () {\n          var lineX = 60;\n          var scale = options.scale;\n          ticksUpdated = null;\n          strokes = [];\n\n          var createStrokes = function (ticks) {\n              for (var i = 0; i < ticks.length; i++) {\n                  var currentYPositive = ticks[i] * radius / ticks[ticks.length - 1];\n                  var currentYNegative = -1 * ticks[i] * radius / ticks[ticks.length - 1];\n                  strokes.push({x1: lineX - 10, x2: lineX + 10, y1: currentYPositive, y2: currentYPositive});\n                  strokes.push({x1: lineX - 10, x2: lineX + 10, y1: currentYNegative, y2: currentYNegative});\n              }\n          };\n\n          if (scale == 'linear') {\n              createStrokes(ticks);\n          }\n          if (scale == 'square') {\n              ticksUpdated = [];\n              for (var i = 0; i < ticks.length; i++) {\n                  var currentTick = ticks[i] * ticks[i];\n                  ticksUpdated.push(currentTick);\n              }\n              createStrokes(ticksUpdated);\n          }\n          if (~scale.indexOf('log')) {\n              var logBase = scale.match(/\\d+/)[0];\n              var minV = Math.log(0.1) / Math.log(logBase);\n              ticksUpdated = [];\n              for (var i = 0; i < ticks.length; i++) {\n                  var currentTick = Math.log(ticks[i] + 0.1) / Math.log(logBase);\n                  currentTick += Math.abs(minV);\n                  ticksUpdated.push(currentTick);\n              }\n              createStrokes(ticksUpdated);\n          }\n\n          var strokesEl = points_scale.selectAll('.stroke')\n                                      .data(strokes);\n\n          strokesEl.enter().append('line');\n          strokesEl.exit().remove();\n\n          strokesEl.attr('x1', function(d) { return d.x1; })\n                   .attr('y1', function(d) { return d.y1; })\n                   .attr('x2', function(d) { return d.x2; })\n                   .attr('y2', function(d) { return d.y2; })\n                   .attr('class', 'stroke')\n                   .style('stroke', '#fff')\n                   .style('stroke-width', '3px');\n      }\n\n      function buildColoredScale () {\n          var dotColors = options.dotColors;\n\n          if (dotColors.length < 2 || !preparedData.speeds.speed_main) {\n              colored_scale.style('display', 'none');\n              return;\n          }\n\n          var lineX = 20;\n          var d = [];\n          var numOfBlocks = 20;\n          for (var i = 0; i <= numOfBlocks; i++) {\n              var y1 = radius - i * 2 * radius/(numOfBlocks + 1);\n              var y2 = y1 - 2 * radius/(numOfBlocks + 1);\n              var color = getColorAtPoint(i, 0, numOfBlocks, dotColors);\n              d.push({y1: y1, y2: y2, color: color});\n          }\n\n          var coloredScaleEl = colored_scale.selectAll('.colored_scale_block')\n                                            .data(d);\n\n          coloredScaleEl.enter().append('line');\n          coloredScaleEl.exit().remove();\n\n          coloredScaleEl.attr('x1', lineX)\n                        .attr('y1', function(d) { return d.y1; })\n                        .attr('x2', lineX)\n                        .attr('y2', function(d) { return d.y2; })\n                        .attr('class', 'colored_scale_block')\n                        .style('stroke', function (d) { return d.color; })\n                        .style('stroke-width', '12px');\n      }\n\n      function buildColoredScaleLabels () {\n          var dotColors = options.dotColors;\n\n          if (dotColors.length < 2 || !preparedData.speeds.speed_main) {\n              colored_scale.style('display', 'none');\n              return;\n          }\n\n          var gradientBasedOn = options.gradientBasedOn;\n          var colorsObj = getColorsObj();\n          var x = 35;\n          var yOffset = 5;\n          var d = [];\n          var numOfBlocks = 20;\n          var title = '';\n\n          for (var i = 0; i <= numOfBlocks + 1; i++) {\n              var y = radius - i * 2 * radius/(numOfBlocks + 1) + yOffset;\n              var text = '';\n              if (gradientBasedOn == 'age') {\n                  var time = Object.keys(preparedData.direction.datapoints);\n                  var minTime = +time[0];\n                  var maxTime = +time[time.length - 1];\n                  var stepTime = (maxTime - minTime) / (numOfBlocks + 1);\n                  text = moment(minTime + i * stepTime).format('YYYY-MM-DD HH:mm');\n                  title = 'Age';\n              } else {\n                  if (!colorsObj) {\n                      return;\n                  }\n                  var colorsArr = _.toArray(colorsObj);\n                  var minVal = _.min(colorsArr);\n                  var maxVal = _.max(colorsArr);\n                  var stepVal = (maxVal - minVal) / (numOfBlocks + 1);\n                  text = Math.round((minVal + i * stepVal) * 100) / 100;\n                  title = gradientBasedOn;\n              }\n              d.push({y: y, text: text});\n          }\n\n          var coloredScaleLabelEl = colored_scale.selectAll('.colored_scale_label')\n                                                  .data(d);\n\n          coloredScaleLabelEl.enter().append('text');\n          coloredScaleLabelEl.exit().remove();\n\n          coloredScaleLabelEl.attr('x', x)\n                            .attr('y', function(d) { return d.y; })\n                            .attr('class', 'colored_scale_label')\n                            .text(function (d) { return d.text; })\n                            .style('fill', '#fff')\n                            .style('font-size', '13px');\n\n          var coloredScaleTitleEl = colored_scale.selectAll('.colored_scale_title')\n                                                  .data([title]);\n\n          coloredScaleTitleEl.enter().append('text');\n          coloredScaleTitleEl.exit().remove();\n\n          coloredScaleTitleEl.attr('x', -50)\n                            .attr('y', 0)\n                            .attr('class', 'colored_scale_title')\n                            .text(function (d) { return d; })\n                            .attr('transform', 'rotate(270, 0, 0)')\n                            .style('fill', '#fff');\n      }\n\n      function buildR (r) {\n          var circleEl = circles_container.selectAll('.circle')\n                                          .data(r);\n\n          circleEl.enter().append('circle');\n          circleEl.exit().remove();\n\n          circleEl.attr('r', function(d) { return d; })\n                  .attr('class', 'circle')\n                  .style('fill', '#fff')\n                  .style('stroke', '#dcdcdc');\n      }\n\n      function buildCircumferences () {\n          var r = [];\n          var createR = function (ticks) {\n              for (var i = ticks.length-1; i >= 0; i--) {\n                  var current_r = ticks[i] * radius / ticks[ticks.length - 1];\n                  r.push(current_r);\n              }\n          };\n\n          createR(ticksUpdated || ticks);\n\n          buildR(r);\n      }\n\n      function buildChartCircumferences (num) {\n          var r = [];\n          for (var i = 0; i < num; i++) {\n              r.push(radius - i * radius / num);\n          }\n\n          buildR(r);\n      }\n\n      function buildPercentsScale (num, percents, alpha) {\n          if (alpha < 0) {\n              var offset = Math.abs(parseInt(alpha/360)) + 1;\n              alpha += (360 * offset);\n          }\n          if (alpha > 360) {\n              var offset = parseInt(alpha/360);\n              alpha -= (360 * offset);\n          }\n          var d = [];\n          for (var i = 0; i < num; i++) {\n              var hypotenuse = radius - i * radius/num - 10;\n              var x = Math.sin(alpha * Math.PI / 180) * hypotenuse;\n              var y = Math.sqrt(hypotenuse * hypotenuse - x * x);\n              if (alpha < 90 || alpha > 270) {\n                  y *= -1;\n              }\n              var textAnchor = 'start';\n              if (alpha < 180) {\n                  textAnchor = 'end';\n              }\n              var text = percents[i] + '%';\n              d.push({x: x, y: y, text: text, textAnchor: textAnchor});\n          }\n\n          var percentsScaleEl = percents_scale_container.selectAll('.percents')\n                                                        .data(d);\n\n          percentsScaleEl.enter().append('text');\n          percentsScaleEl.exit().remove();\n\n          percentsScaleEl.attr('x', function (d) { return d.x; })\n                         .attr('y', function(d) { return d.y; })\n                         .text(function (d) { return d.text; })\n                         .attr('class', 'percents')\n                         .style('fill', '#a0a0a0')\n                         .style('text-anchor', function (d) { return d.textAnchor; })\n                         .style('font-size', '13px');\n      }\n\n      function togglePercents () {\n          var showPercents = options.showPercents;\n          if (showPercents) {\n              percents_scale_container.style('display', 'block');\n          } else {\n              percents_scale_container.style('display', 'none');\n          }\n      }\n\n      function buildAxis () {\n          var degree = +options.axisFrequency;\n          var axis = [];\n          var betta = 0;\n          var pi = Math.PI;\n\n          var round = function (val) {\n              return Math.round(val * 100) / 100;\n          };\n\n          while (betta != 180) {\n              var x1 = round(Math.cos(betta * pi / 180)) * radius;\n              var x2 = round(Math.cos((betta + 180) * pi / 180)) * radius;\n              var y1 = round(Math.sin(betta * pi / 180)) * radius;\n              var y2 = round(Math.sin((betta + 180) * pi / 180)) * radius;\n              var color = betta == 0 || betta == 90 ? '#1f1d1d' : '#dcdcdc';\n              axis.push({x1: x1, y1: y1, x2: x2, y2: y2, color: color});\n              betta += degree;\n          }\n\n          var axisEl = axis_container.selectAll('.line')\n                                     .data(axis);\n\n          axisEl.enter().append('line');\n          axisEl.exit().remove();\n\n          axisEl.attr('x1', function(d) { return d.x1; })\n                .attr('y1', function(d) { return d.y1; })\n                .attr('x2', function(d) { return d.x2; })\n                .attr('y2', function(d) { return d.y2; })\n                .attr('class', 'line')\n                .style('stroke', function(d) { return d.color; });\n      }\n\n      function buildStrokesLabels () {\n          var labels = [];\n          var xCoord = 45;\n          var yShift = 6;\n\n          var createLabels = function (labelTicks) {\n              for (var i = 0; i < labelTicks.length; i++) {\n                  var yCoordPositive = labelTicks[i] * radius / labelTicks[labelTicks.length - 1] + yShift;\n                  var yCoordNegative = -1 * labelTicks[i] * radius / labelTicks[ticks.length - 1] + yShift;\n                  labels.push({text: ticks[i], x: xCoord, y: yCoordPositive});\n                  labels.push({text: ticks[i], x: xCoord, y: yCoordNegative});\n              }\n          };\n\n          createLabels(ticksUpdated || ticks);\n\n          var labelEl = points_scale.selectAll('.axis-label')\n                                       .data(labels);\n\n          labelEl.enter().append('text');\n          labelEl.exit().remove();\n\n          labelEl.attr('x', function(d) { return d.x; })\n                 .attr('y', function(d) { return d.y; })\n                 .attr('class', 'axis-label')\n                 .text(function(d) { return d.text; })\n                 .style('fill', '#fff')\n                 .style('font-size', '14px')\n                 .style('text-anchor', 'end');\n      }\n\n      function buildPoints (points) {\n          var circleEl = points_container.selectAll('.circle')\n                                         .data(points);\n\n          circleEl.enter().append('circle');\n          circleEl.exit().remove();\n\n          circleEl.attr('cx', function(d) { return d.x; })\n                  .attr('cy', function(d) { return d.y; })\n                  .attr('r', function(d) { return pointR; })\n                  .attr('fill', function(d) { return d.color; })\n                  .attr('class', 'circle')\n                  .on('mouseover', function (d) {\n                      div.style('opacity', 1);\n                      var html = '<div class=\"time\">' + d.time + '</div> wind_speed: <span class=\"value\">' + d.wind_speed + '</span><br/> wind_dir: <span class=\"value\">' + d.wind_dir + '</span>';\n                      if (d.extra) {\n                          html += '<br>' + d.extra.title + ': <span class=\"value\">' + d.extra.val + '</span>';\n                      }\n                      div.html(html)\n                          .style('left', (d3.event.pageX + 15) + 'px')\n                          .style('top', (d3.event.pageY - 38) + 'px');\n                  })\n                  .on('mouseout', function () {\n                      div.style('opacity', 0)\n                         .style('left', 0)\n                         .style('top', 0);\n                  })\n                  .style('opacity', function(d) { return d.opacity; });\n      }\n\n      function buildChart (d) {\n          var arcEl = chart_container.selectAll('.arc')\n                                     .data(d);\n\n          arcEl.enter().append('path');\n          arcEl.exit().remove();\n\n          arcEl.attr('d', function (d) { return d.arc(); })\n               .attr('class', 'arc')\n               .on('mouseover', function (d) {\n                    div.style('opacity', 1);\n\n                    var html = '<div class=\"angle\">' + d.startAngle + '\\u00B0  -  ' + d.endAngle + '\\u00B0</div>';\n                    for (var i = 0; i < d.percents.length - 1; i++) {\n                        html += '<div class=\"colored_box\" style=\"background-color: ' + d.percents[i]['color'] + '\"></div> <span class=\"percent\">' + d.percents[i]['val'] + '%</span><br/>';\n                    }\n                    html += '<div class=\"total\"><span>Total:</span><span class=\"percent\">' + d.percents[d.percents.length - 1]['val'] + '%</span></div>';\n                    div.html(html)\n                       .style('left', (d3.event.pageX + 15) + 'px')\n                       .style('top', (d3.event.pageY - 38) + 'px');\n                })\n                .on('mouseout', function () {\n                        div.style('opacity', 0)\n                           .style('left', 0)\n                           .style('top', 0);\n                })\n                .style('fill', function (d) { return d.color; });\n      }\n\n      function buildExtraLines () {\n          if (!peaksData) {\n              return;\n          }\n\n          var lines_data = [];\n          var points_data = [];\n          var bars_data = [];\n\n          _.each(peaksData, function (item) {\n              if (item.lines) {\n                  lines_data.push(item);\n              }\n              if (item.points) {\n                  points_data.push(item);\n              }\n              if (item.bars) {\n                  bars_data.push(item);\n              }\n          });\n\n          var lineFunc = d3.svg.line()\n                               .x(function (d) { return d.x; })\n                               .y(function (d) { return d.y; })\n                               .interpolate('linear');\n\n          var curveEl = curve_container.selectAll('.peak_line')\n                                       .data(lines_data);\n\n          curveEl.enter().append('path');\n          curveEl.exit().remove();\n\n          curveEl.attr('d', function (d) { return lineFunc(d.curve); })\n                 .attr('stroke', function (d) { return d.curve[0]['color']; })\n                 .attr('stroke-width', function (d) { return d.curve[0]['line_width']; })\n                 .attr('fill', function (d) { return d.curve[0]['color']; })\n                 .attr('fill-opacity', function (d) { return d.curve[0]['fill']; })\n                 .attr('class', 'peak_line sortable show_tooltip');\n\n          var curveElPointsContainer = curve_container.selectAll('.peak_points_container')\n                                                      .data(points_data);\n\n          curveElPointsContainer.enter().append('g');\n          curveElPointsContainer.exit().remove();\n\n          curveElPointsContainer.attr('class', 'peak_points_container sortable');\n\n          var curveElPoints = curveElPointsContainer.selectAll('.peak_points')\n                                                    .data(function (d) { return d.curve; });\n\n          curveElPoints.enter().append('circle');\n          curveElPoints.exit().remove();\n\n          curveElPoints.attr('cx', function (d) { return d.x; })\n                        .attr('cy', function (d) { return d.y; })\n                        .attr('r', function (d) { return d.point_radius; })\n                        .attr('fill', function (d) { return d.color; })\n                        .attr('class', 'peak_points show_tooltip');\n\n          var curveElBarsContainer = curve_container.selectAll('.peak_bars_container')\n                                                    .data(bars_data);\n\n          curveElBarsContainer.enter().append('g');\n          curveElBarsContainer.exit().remove();\n\n          curveElBarsContainer.attr('class', 'peak_bars_container sortable');\n\n          var curveElBars = curveElBarsContainer.selectAll('.peak_bar')\n                                                 .data(function (d) { return d.curve; });\n\n          curveElBars.enter().append('line');\n          curveElBars.exit().remove();\n\n          curveElBars.attr('x1', function (d) { return d.x; })\n                    .attr('y1', function (d) { return d.y; })\n                    .attr('x2', 0)\n                    .attr('y2', 0)\n                    .attr('stroke', function (d) { return d.color; })\n                    .attr('stroke-width', function (d) { return d.line_width; })\n                    .attr('class', 'peak_bar show_tooltip');\n\n          svg.selectAll('.sortable').sort(function (a, b) {\n              var a_z = a && a.z_index ? a.z_index : 0;\n              var b_z = b && b.z_index ? b.z_index : 0;\n              return a_z > b_z ? 1 : -1;\n          });\n\n          defineTooltip();\n      }\n\n      function addCompassRoseAsBackground () {\n          var compassRose = options.labelCompassRose;\n\n          setTimeout(function () {\n              if (compassRose) {\n                  svg.select('.bg_container')\n                     .attr('fill', 'url(#' + bgId + ')');\n              } else {\n                  svg.select('.bg_container')\n                     .attr('fill', 'none');\n              }\n          }, 500);\n      }\n\n      function setCompassRoseOpacity () {\n          var compassRoseOpacity = options.labelCompassRoseOpacity;\n          svg.select('.bg_container').style('opacity', function (d) { return compassRoseOpacity; });\n      }\n\n      function styleAxisLabels () {\n          var degrees = options.labelDegrees;\n          var cardinalCompass = options.labelCardinalCompass;\n          var intercardinalCompass = options.labelIntercardinalCompass;\n          var compassRose = options.labelCompassRose;\n\n          var alpha = +options.axisFrequency;\n          var hardcoded_r = radius + 20;\n          var delta = degrees ? 30 : 0;\n          var labels = [];\n\n          var getAngleCoords = function (init_alpha, delta) {\n              var current_alpha = init_alpha;\n              delta = delta || 0;\n\n              if (init_alpha >= 90 && init_alpha < 270) {\n                  current_alpha = Math.abs(current_alpha - 180);\n              }\n              if (init_alpha >= 270 && init_alpha < 360) {\n                  current_alpha = Math.abs(current_alpha - 360);\n              }\n\n              if (init_alpha > 90 && init_alpha < 270) {\n                  hardcoded_r = radius + 30 + delta;\n              } else {\n                  hardcoded_r = radius + 20 + delta;\n              }\n\n              var x = Math.sin(current_alpha * Math.PI / 180) * hardcoded_r;\n              if (init_alpha > 180) {\n                  x *= -1;\n              }\n\n              var y = Math.sqrt(hardcoded_r * hardcoded_r - x* x);\n              y *= -1;\n              if (init_alpha > 90 && init_alpha < 270) {\n                  y *= -1;\n              }\n              return {x: x, y: y};\n          };\n\n          if (degrees) {\n              for (var i = 0; i < 360 / alpha; i++) {\n                  var init_alpha = i * alpha;\n                  var coords = getAngleCoords(init_alpha);\n                  labels.push({x: coords.x, y: coords.y, text: init_alpha + '\\u00B0'});\n              }\n          }\n          if (cardinalCompass) {\n              labels.push({x: 0, y: -1* radius - 10 - delta, text: 'N', fontSize: '18px'});\n              labels.push({x: radius + 15 + delta, y: 0, text: 'E', fontSize: '18px'});\n              labels.push({x: 0, y: radius + 20 + delta, text: 'S', fontSize: '18px'});\n              labels.push({x: -1 * radius - 20 - delta, y: 0, text: 'W', fontSize: '18px'});\n          }\n          if (cardinalCompass && intercardinalCompass) {\n              var compass = [{\n                  angle: 45,\n                  val: 'NE'\n              }, {\n                  angle: 135,\n                  val: 'SE'\n              }, {\n                  angle: 225,\n                  val: 'SW'\n              }, {\n                  angle: 315,\n                  val: 'NW'\n              }];\n\n              _.each(compass, function (item) {\n                  var init_alpha = item.angle;\n                  var coords = getAngleCoords(init_alpha, delta);\n                  labels.push({x: coords.x, y: coords.y, text: item.val, fontSize: '18px'});\n              });\n          }\n\n          var axisStyleEl = svg.selectAll('.axis-style')\n                               .data(labels);\n\n          axisStyleEl.enter().append('text');\n          axisStyleEl.exit().remove();\n\n          axisStyleEl.attr('x', function (d) { return d.x; })\n                      .attr('y', function (d) { return d.y; })\n                      .text(function (d) { return d.text; })\n                      .attr('fill', '#fff')\n                      .attr('class', 'axis-style')\n                      .attr('startOffset', '100%')\n                      .style('text-anchor', 'middle')\n                      .style('font-size', function (d) { return d.fontSize || '14px'; });\n      }\n\n      function setChartOpacity () {\n          var chartOpacity = options.chartOpacity;\n          chart_container.style('opacity', chartOpacity);\n      }\n\n      function toggleWindRoseType (type) {\n          var showPercents = options.showPercents;\n          switch (type) {\n              case 'chart':\n                  curve_container.style('display', 'none');\n                  points_scale.style('display', 'none');\n                  colored_scale.style('display', 'none');\n                  chart_container.style('display', 'block');\n                  chart_scale.style('display', 'block');\n                  if (showPercents) {\n                      percents_scale_container.style('display', 'block');\n                  }\n                  break;\n              case 'points':\n                  chart_container.style('display', 'none');\n                  chart_scale.style('display', 'none');\n                  percents_scale_container.style('display', 'none');\n                  curve_container.style('display', 'block');\n                  points_scale.style('display', 'block');\n                  points_container.style('display', 'block');\n                  colored_scale.style('display', 'block');\n                  break;\n          }\n      }\n\n      function renderExtraLines (preparedSpeeds) {\n          var windRoseType = options.windRoseType;\n          var peakTypeBar = options.peakTypeBar;\n          var peakTypeLine = options.peakTypeLine;\n          var peakTypePoints = options.peakTypePoints;\n          var peakTypeLineFill = +options.peakTypeLineFill/10 || 0;\n          var peakTypeLineWidth = options.peakTypeLineWidth || 1;\n          var peakTypePointsRadius = options.peakTypePointsRadius || 2;\n\n          var overrides = panel.seriesOverrides;\n\n          if (!preparedData || !preparedData.direction) {\n              return;\n          }\n\n          var res = {};\n          var directions = preparedData.direction.datapoints;\n          _.each(preparedSpeeds, function (item, key) {\n              if (key == 'speed_main') {\n                  return;\n              }\n              var alias = item.alias;\n              res[alias] = [];\n              _.each(directions, function (point, time) {\n                  point = Math.round(point);\n                  if (!res[alias][point]) {\n                      res[alias][point] = {v: item['datapoints'][time], time: time, key: key};\n                      res[alias][point]['length'] = 1;\n                      return;\n                  }\n                  switch (key) {\n                      case 'speed_max':\n                          if (item['datapoints'][time] > res[alias][point]['v']) {\n                              res[alias][point] = {v: item['datapoints'][time], time: time, key: key};\n                          }\n                          break;\n                      case 'speed_min':\n                          if (item['datapoints'][time] < res[alias][point]['v']) {\n                              res[alias][point] = {v: item['datapoints'][time], time: time, key: key};\n                          }\n                          break;\n                      case 'speed_avg':\n                          res[alias][point]['v'] += item['datapoints'][time];\n                          res[alias][point]['key'] = key;\n                          res[alias][point]['length'] += 1;\n                  }\n              });\n          });\n          var j = 0;\n          peaksData = _.map(res, function (data, key) {\n              var color = randomColors[j];\n              j++;\n              var key_overrides = _.find(overrides, function (item) { return item.alias == key; });\n              var curve = _.map(data, function (point, i) {\n                  var curvePointObj = {\n                      color: key_overrides && angular.isDefined(key_overrides.color) ? key_overrides.color : color,\n                      fill: key_overrides && angular.isDefined(key_overrides.fill) ? key_overrides.fill : peakTypeLineFill,\n                      line_width: key_overrides && angular.isDefined(key_overrides.linewidth) ? key_overrides.linewidth : peakTypeLineWidth,\n                      point_radius: key_overrides && angular.isDefined(key_overrides.pointradius) ? key_overrides.pointradius : peakTypePointsRadius,\n                      z_index: key_overrides && angular.isDefined(key_overrides.zindex) ? key_overrides.zindex : 0,\n                      alias: key.split('[')[0]\n                  };\n                  if (!point) {\n                      return _.assignIn(curvePointObj, {\n                          x: 0,\n                          y: 0,\n                          v: 0,\n                          time: null,\n                          hide: true\n                      });\n                  }\n                  var v = point['v'];\n                  var time = +point['time'];\n                  var speed_name = point['key'];\n\n                  if (speed_name == 'speed_avg') {\n                      v /= point['length'];\n                      time = null;\n                  }\n                  if (v > radius) {\n                      v = radius;\n                  }\n                  var x = Math.sin(i * Math.PI / 180) * v;\n                  var y = Math.sqrt(v * v - x * x);\n                  if (i < 90 || i > 270) {\n                      y *= -1;\n                  }\n                  return _.assignIn(curvePointObj, {\n                      x: x,\n                      y: y,\n                      v: Math.round(v * maxV / radius * 100)/100 + ' m/s',\n                      time: time ? moment(time).format('YYYY-MM-DD HH:mm:ss') : null\n                  });\n              });\n\n              return { curve: curve,\n                      bars: key_overrides && angular.isDefined(key_overrides.bars) ? key_overrides.bars : peakTypeBar,\n                      lines: key_overrides && angular.isDefined(key_overrides.lines) ? key_overrides.lines : peakTypeLine,\n                      points: key_overrides && angular.isDefined(key_overrides.points) ? key_overrides.points : peakTypePoints,\n                      z_index: key_overrides && angular.isDefined(key_overrides.zindex) ? key_overrides.zindex : 0\n              };\n          });\n          buildExtraLines();\n      }\n\n      function renderChart () {\n          var numOfDirections = options.numOfDirections;\n          var windSpeedStep = +options.windSpeedStep || 0.1;\n          var percentsPosition = +options.percentsPosition || 45;\n          var chartColors = options.chartColors;\n\n          var d = [];\n          var percents = [];\n          var totalPercents = {0: 0};\n          var res = {};\n\n          if (!preparedData || !preparedData.direction || !preparedData.speeds || !preparedData.speeds.speed_main) {\n              return;\n          }\n\n          var directions = preparedData.direction.datapoints;\n          var velocities = preparedData.speeds.speed_main.datapoints;\n          var velocitiesArray = _.toArray(velocities);\n\n          var alpha = 360 / numOfDirections;\n          var numOfCircles = 6;\n          var maxColorVal = Math.floor(getMinMaxVelocity(velocities)[1] / windSpeedStep);\n\n          _.each(directions, function (point, time) {\n              if (point >= 360 - alpha/2) {\n                  point -= 360;\n              }\n              var segment = parseInt((point + alpha/2) / alpha);\n              if ( velocities[time] == 0) {\n                  totalPercents[0] +=1;\n                  return;\n              }\n              if (res[segment]) {\n                  res[segment].push([velocities[time], +time]);\n              } else {\n                  res[segment] = [[velocities[time], +time]];\n              }\n          });\n\n          var maxSegment = 0;\n          _.each(res, function (segment) {\n              if (segment.length > maxSegment) {\n                  maxSegment = segment.length;\n              }\n          });\n\n          var zeroR = radius * totalPercents[0] / velocitiesArray.length;\n          var maxPercentInScale = 0;\n\n          _.each(res, function (segment, i) {\n              var innerSegments = _.groupBy(segment, function (point) {\n                  return parseInt(point[0]/windSpeedStep);\n              });\n\n              var angleOffset = 1;\n              var startAngleInit = -1 * alpha/2 + i*alpha;\n              var endAngleInit = startAngleInit + alpha;\n              var startAngle = (startAngleInit + angleOffset) * Math.PI / 180;\n              var endAngle = (endAngleInit - angleOffset) * Math.PI / 180;\n              var innerR = zeroR;\n              var outerR = (radius - zeroR - 20) * segment.length / maxSegment;\n\n              percents[i] = [];\n\n              _.each(innerSegments, function (innerSegment, v) {\n                  var innerSegmentOuterR = innerR + outerR * innerSegment.length / segment.length;\n                  var color = getColorAtPoint(+v, 0, maxColorVal, chartColors);\n                  var arc = d3.svg.arc()\n                                  .innerRadius(innerR)\n                                  .outerRadius(innerSegmentOuterR)\n                                  .startAngle(startAngle)\n                                  .endAngle(endAngle);\n\n                  d.push({arc: arc, color: color, percents: percents[i], startAngle: startAngleInit, endAngle: endAngleInit});\n\n                  innerR = innerSegmentOuterR;\n                  if ( ! totalPercents[+v + 1]) {\n                      totalPercents[+v + 1] = 0;\n                  }\n                  totalPercents[+v + 1] += innerSegment.length;\n                  var innerSegmentPercents = Math.round((innerSegment.length * 100 / segment.length) * 10) / 10;\n                  percents[i].push({val: innerSegmentPercents, color: color});\n              });\n              var segmentPercents = Math.round((segment.length * 100 / velocitiesArray.length) * 10) / 10;\n              if (segmentPercents > maxPercentInScale) {\n                  maxPercentInScale = segmentPercents;\n              }\n              percents[i].push({val: segmentPercents});\n          });\n\n          maxPercentInScale = maxPercentInScale * radius / (radius - 20);\n\n          var percentsScale = [];\n          for (var i = 0; i < numOfCircles; i++) {\n              percentsScale.push(Math.round((maxPercentInScale - i * maxPercentInScale / numOfCircles) * 10) / 10);\n          }\n\n          totalPercents = _.map(totalPercents, function (num) {\n              return Math.round((num * 100 / velocitiesArray.length) * 10) / 10;\n          });\n\n          buildChart(d);\n          buildChartCircumferences(numOfCircles);\n          buildPercentsScale(numOfCircles, percentsScale, percentsPosition);\n          buildChartScale(maxColorVal);\n          buildChartScaleLabels(windSpeedStep, maxColorVal, totalPercents);\n\n          toggleWindRoseType('chart');\n      }\n\n      function renderPoints (preparedSpeeds) {\n          var alphaBlending = options.alphaBlending;\n          var alphaBlendingMinOpacity = options.alphaBlendingMinOpacity || 0;\n          var gradientBasedOn = options.gradientBasedOn;\n          var lastPointColor = options.lastPointColor;\n          var dotColors = options.dotColors;\n          var new_points = [];\n          var filtredAngles = {};\n          var filtredVelocities = {};\n\n          if (!preparedData || !preparedData.direction) {\n              return;\n          }\n\n          var directions = preparedData.direction.datapoints;\n          var timeKeysArray = Object.keys(directions);\n          var main_speed = preparedData.speeds.speed_main ? preparedData.speeds.speed_main.datapoints : [];\n          var minMaxTime = [timeKeysArray[0], timeKeysArray[timeKeysArray.length - 1]]; //returns [min,max] time\n          var diffTime = minMaxTime[1] - minMaxTime[0];\n\n          var prepared_main_speed = preparedSpeeds.speed_main ? preparedSpeeds.speed_main.datapoints : [];\n\n          var colorsObj = getColorsObj();\n\n          _.each(main_speed, function (point, i) {\n              if (point <= maxV) {\n                    filtredAngles[i] = directions[i];\n                    filtredVelocities[i] = main_speed[i];\n              }\n          });\n\n          var realMinMaxV = getMinMaxVelocity(prepared_main_speed); //returns [min, max]\n\n          var getColor = function (i) {\n              if (i == minMaxTime[1]) {\n                  return lastPointColor;\n              }\n              var pointVal, pointMinVal, pointMaxVal;\n              if (gradientBasedOn == 'age') {\n                  pointVal = +i;\n                  pointMinVal = +minMaxTime[0];\n                  pointMaxVal = +minMaxTime[1];\n              } else {\n                  if (!colorsObj) {\n                      return;\n                  }\n                  var colorsArr = _.toArray(colorsObj);\n                  pointVal = colorsObj[i];\n                  pointMinVal = _.min(colorsArr);\n                  pointMaxVal = _.max(colorsArr);\n              }\n              return getColorAtPoint(pointVal, pointMinVal, pointMaxVal, dotColors);\n          };\n\n          _.each(filtredAngles, function (point, i) {\n              var alpha = point;\n              var init_alpha = alpha;\n\n              if (init_alpha >= 90 && init_alpha < 270) {\n                  alpha = Math.abs(alpha - 180);\n              }\n              if (init_alpha >= 270 && init_alpha < 360) {\n                  alpha = Math.abs(alpha - 360);\n              }\n              var x = Math.sin(alpha * Math.PI / 180) * prepared_main_speed[i];\n              if (init_alpha > 180) {\n                  x *= -1;\n              }\n\n              var y = Math.sqrt(prepared_main_speed[i] * prepared_main_speed[i] - x * x);\n              y *= -1;\n              if (init_alpha > 90 && init_alpha < 270) {\n                  y *= -1;\n              }\n              var color = getColor(i);\n              var d = {\n                x: x,\n                y: y,\n                opacity: alphaBlending ? 1 - (minMaxTime[1] - i) / diffTime + alphaBlendingMinOpacity : 1,\n                color: color,\n                time: moment(+i).format('YYYY-MM-DD HH:mm:ss'),\n                wind_speed: Math.round(filtredVelocities[i] * 100)/100 + ' m/s',\n                wind_dir: Math.round(point) + '\\u00B0'\n              };\n              if (gradientBasedOn != 'age' && gradientBasedOn != 'wind_speed') {\n                  d.extra = {\n                      title: gradientBasedOn,\n                      val: Math.round(colorsObj[i] * 100) / 100\n                  };\n              }\n              new_points.push(d);\n          });\n          buildPoints(new_points);\n      }\n\n      function renderPointsPanel () {\n          if (!preparedData || !preparedData.direction) {\n              return;\n          }\n\n          var preparedSpeeds = prepareSpeeds();\n\n          buildScale();\n          buildStrokesLabels();\n          buildCircumferences();\n          buildColoredScale();\n          buildColoredScaleLabels();\n\n          renderPoints(preparedSpeeds);\n          renderExtraLines(preparedSpeeds);\n\n          toggleWindRoseType('points');\n      }\n\n      //helpers\n      function guid() {\n          function s4() {\n              return Math.floor((1 + Math.random()) * 0x10000)\n                         .toString(16)\n                         .substring(1);\n          }\n          return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n      }\n\n      function getColorAtPoint (val, minVal, maxVal, colors) {\n          if (colors.length == 1) {\n              return colors[0];\n          }\n          Rainbow.setSpectrumByArray(colors);\n          Rainbow.setNumberRange(minVal, maxVal);\n          return '#' + Rainbow.colourAt(val);\n      }\n\n      function generateRandomColors (length) {\n          if (randomColors.length >= length) {\n              return;\n          }\n          var letters = '0123456789ABCDEF';\n          for (var j = 0; j < length - randomColors.length; j++) {\n              var color = '#';\n              for (var i = 0; i < 6; i++ ) {\n                  color += letters[Math.floor(Math.random() * 16)];\n              }\n              randomColors.push(color);\n          }\n      }\n\n      function getColorsObj () {\n          var gradientBasedOn = options.gradientBasedOn;\n          var  colorsObj = null;\n\n          if (gradientBasedOn != 'age') {\n              var colorBasedOnSpeed = _.find(preparedData.speeds, function (speed) {\n                  return speed.alias.split('[')[0] == gradientBasedOn;\n              });\n              if (colorBasedOnSpeed) {\n                  colorsObj = colorBasedOnSpeed['datapoints'];\n              }\n              if (preparedData.color && preparedData.color[gradientBasedOn]) {\n                  colorsObj = preparedData.color[gradientBasedOn]['datapoints'];\n              }\n              if (!colorsObj) {\n                  scope.ctrl.panel.windRoseOptions.gradientBasedOn = 'age';\n                  options.gradientBasedOn = 'age';\n              }\n          }\n          return colorsObj;\n      }\n\n      function getMinMaxVelocity (velocities) {\n          var min, max;\n          var time = Object.keys(velocities);\n          min = max = velocities[time[0]];\n          _.each(velocities, function (v) {\n              if (v < min) {\n                  min = v;\n              }\n              if (v > max) {\n                  max = v;\n              }\n          });\n          return [min, max];\n      }\n\n      function prepareSpeeds () {\n          var scale = options.scale;\n          var defaultMaxV = options.maxV;\n          var logBase = null;\n\n          ticks = [];\n\n          var speeds = angular.copy(preparedData.speeds);\n\n          var getMaxV = function () {\n              if (defaultMaxV) {\n                  return defaultMaxV;\n              }\n              var max = 0;\n              _.each(speeds, function (item) {\n                  var current_max = _.chain(item.datapoints).toArray().max().value();\n                  if (current_max > max) {\n                      max = current_max;\n                  }\n              });\n              return max;\n          };\n\n          maxV = getMaxV();\n\n          if (scale == 'square') {\n              _.each(speeds, function (item) {\n                  _.each(item.datapoints, function (point, i) {\n                      item.datapoints[i] *= point;\n                  });\n              });\n              maxV = defaultMaxV ? maxV : Math.ceil(maxV);\n              ticks = _.range(maxV + 1);\n              ticks[ticks.length - 1] = maxV;\n              maxV *= maxV;\n          }\n          if (~scale.indexOf('log')) {\n              logBase = scale.match(/\\d+/)[0];\n              ticks = [0, 1];\n              var currentTick = 1;\n              while (maxV > currentTick) {\n                  currentTick = currentTick *  logBase;\n                  currentTick = defaultMaxV && currentTick > maxV ? maxV : currentTick;\n                  ticks.push(currentTick);\n              }\n\n              var minV = Math.log(0.1) / Math.log(logBase);\n              maxV = Math.log(ticks[ticks.length - 1]) / Math.log(logBase);\n              maxV += Math.abs(minV);\n\n              _.each(speeds, function (item) {\n                  _.each(item.datapoints, function (point, i) {\n                      item.datapoints[i] = Math.log(point + 0.1) / Math.log(logBase);\n                      item.datapoints[i] += Math.abs(minV);\n                  });\n              });\n          }\n          if (scale == 'linear') {\n              maxV = defaultMaxV ? maxV : Math.ceil(maxV * 2) / 2;\n              var scaleStep = 0.5;\n              while (maxV/scaleStep > 7) {\n                  scaleStep += 0.5;\n              }\n              for (var i=0; i <= maxV; i += scaleStep) {\n                  ticks.push(i);\n              }\n              if (ticks[ticks.length - 1] != maxV) {\n                  ticks.push(maxV);\n              }\n          }\n\n          _.each(speeds, function (item) {\n              _.each(item.datapoints, function (point, i) {\n                  item.datapoints[i] = point * radius / maxV;\n              });\n          });\n          return speeds;\n      }\n\n      function prepareData () {\n          dataDirections = [];\n          dataVelocities = [];\n          preparedData = {};\n          extraData = {};\n          if (!data || !data[0] || !data[0]['datapoints'] || !data[1] || !data[1]['datapoints']) {\n              return;\n          }\n          var colors = 0;\n          _.each(data, function (item) {\n              var alias = item.alias;\n              if (!alias) {\n                  return;\n              }\n              var key = alias.match(/\\[(.*)\\]/);\n              if (!key || !key[1]) {\n                  return;\n              }\n              key = key[1];\n              var datapoints = trimDatapoints(item.datapoints);\n              datapoints = createTimedIndex(datapoints);\n              switch (key) {\n                  case 'direction':\n                      preparedData[key] = {\n                          datapoints: datapoints,\n                          alias: alias\n                      };\n                      break;\n                  case 'speed_min':\n                  case 'speed_max':\n                  case 'speed_avg':\n                      colors++;\n                  case 'speed_main':\n                  case 'speed_min':\n                  case 'speed_max':\n                  case 'speed_avg':\n                      if (!preparedData['speeds']) {\n                          preparedData['speeds'] = {};\n                      }\n                      preparedData['speeds'][key] = {\n                          datapoints: datapoints,\n                          alias: alias\n                      };\n                      break;\n                  case 'color':\n                      if (!preparedData['color']) {\n                          preparedData['color'] = {};\n                      }\n                      var colorKey = alias.split('[')[0];\n                      preparedData['color'][colorKey] = {\n                          datapoints: datapoints,\n                          alias: alias\n                      };\n                      break;\n              }\n          });\n          generateRandomColors(colors);\n      }\n\n      function trimDatapoints(datapoints) {\n          var startIndex = 0;\n          var endIndex = datapoints.length > 1 ? datapoints.length - 1 : 0;\n          for (var i = startIndex, l = datapoints.length; i < l; i++) {\n              startIndex = i;\n              if (!isNaN(parseFloat(datapoints[i][0]))) {\n                  break;\n              }\n          }\n          for (var i = endIndex; i > -1; i--) {\n              endIndex = i;\n              if (!isNaN(parseFloat(datapoints[i][0]))) {\n                  break;\n              }\n          }\n          return datapoints.slice(startIndex, endIndex + 1);\n      }\n\n      function createTimedIndex(datapoints) {\n          var timedIndex = {};\n          var timeKey, dataValue;\n          for (var i = 0, l = datapoints.length; i < l; i++) {\n              timeKey = datapoints[i][1];\n              dataValue = datapoints[i][0];\n              if (!isNaN(parseFloat(dataValue))) {\n                  timedIndex[timeKey] = dataValue;\n              }\n          }\n          return timedIndex;\n      }\n\n      ctrl.events.on('render', function (renderData) {\n          data = renderData || data;\n          if (!data || !options.windRoseType) {\n              ctrl.refresh();\n              return;\n          }\n          prepareData();\n          if (options.windRoseType == 2) {\n                return renderChart();\n          }\n          return renderPointsPanel();\n      });\n\n      //WATCHERS\n      scope.$watch('ctrl.panel.windRoseOptions.axisFrequency', function (newVal) {\n          options.axisFrequency = newVal;\n          buildAxis();\n          if (options.labelDegrees) {\n              styleAxisLabels();\n          }\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.axisName', function (newVal) {\n          options.axisName = newVal;\n          setAxisName();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.scale', function (newVal) {\n          options.scale = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.maxV', function (newVal) {\n          options.maxV = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.gradientBasedOn', function (newVal) {\n          options.gradientBasedOn = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.dotColors', function (newVal) {\n          options.dotColors = _.chain(newVal).filter(function (color) {\n                return color.val;\n          }).map(function (color) {\n                return color.val;\n          }).value();\n          if (!options.dotColors.length) {\n                options.dotColors = ['#000000'];\n          }\n          renderPointsPanel();\n      }, true);\n\n      scope.$watch('ctrl.panel.windRoseOptions.lastPointColor', function (newVal) {\n          options.lastPointColor = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.alphaBlending', function (newVal) {\n          options.alphaBlending = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.alphaBlendingMinOpacity', function (newVal) {\n          if (newVal < 0) {\n                scope.ctrl.panel.windRoseOptions.alphaBlendingMinOpacity = 0;\n          }\n          if (newVal > 1) {\n                scope.ctrl.panel.windRoseOptions.alphaBlendingMinOpacity = 1;\n          }\n          options.alphaBlendingMinOpacity = newVal || 0;\n          renderPointsPanel();\n      });\n\n      //labels\n      scope.$watch('ctrl.panel.windRoseOptions.labelDegrees', function (newVal) {\n          options.labelDegrees = newVal;\n          styleAxisLabels();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.labelCardinalCompass', function (newVal) {\n          options.labelCardinalCompass = newVal;\n          styleAxisLabels();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.labelIntercardinalCompass', function (newVal) {\n          options.labelIntercardinalCompass = newVal;\n          styleAxisLabels();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.labelCompassRose', function (newVal) {\n          options.labelCompassRose = newVal;\n          addCompassRoseAsBackground();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.labelCompassRoseOpacity', function (newVal) {\n          if (newVal < 0) {\n              scope.ctrl.panel.windRoseOptions.labelCompassRoseOpacity = 0;\n          }\n          if (newVal > 1) {\n              scope.ctrl.panel.windRoseOptions.labelCompassRoseOpacity = 1;\n          }\n          options.labelCompassRoseOpacity = newVal;\n          setCompassRoseOpacity();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.labelCompassRoseSize', function (newVal) {\n          if (newVal < 0) {\n              scope.ctrl.panel.windRoseOptions.labelCompassRoseSize = 0;\n          }\n          if (newVal > 1) {\n              scope.ctrl.panel.windRoseOptions.labelCompassRoseSize = 1;\n          }\n          options.labelCompassRoseSize = newVal;\n          defineBg();\n      });\n\n      //pie chart\n      scope.$watch('ctrl.panel.windRoseOptions.windRoseType', function (newVal) {\n          options.windRoseType = newVal;\n          if (options.windRoseType == 2) {\n                return renderChart();\n          }\n          return renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.numOfDirections', function (newVal) {\n          options.numOfDirections = newVal;\n          renderChart();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.windSpeedStep', function (newVal) {\n          options.windSpeedStep = newVal;\n          renderChart();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.chartColorFrom', function (newVal) {\n          options.chartColorFrom = newVal;\n          renderChart();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.chartColorTo', function (newVal) {\n          options.chartColorTo = newVal;\n          renderChart();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.showPercents', function (newVal) {\n          options.showPercents = newVal;\n          togglePercents();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.percentsPosition', function (newVal) {\n          options.percentsPosition = newVal;\n          renderChart();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.chartOpacity', function (newVal) {\n          if (newVal < 0) {\n              scope.ctrl.panel.windRoseOptions.chartOpacity = 0;\n          }\n          if (newVal > 1) {\n              scope.ctrl.panel.windRoseOptions.chartOpacity = 1;\n          }\n          options.chartOpacity = newVal;\n          setChartOpacity();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.chartColors', function (newVal) {\n          options.chartColors = _.chain(newVal).filter(function (color) {\n              return color.val;\n          }).map(function (color) {\n              return color.val;\n          }).value();\n          if (!options.chartColors.length) {\n              options.chartColors = ['#000000'];\n          }\n          renderChart();\n      }, true);\n\n      //peaks\n      scope.$watch('ctrl.panel.windRoseOptions.peakTypeBar', function (newVal) {\n          options.peakTypeBar = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.peakTypeLine', function (newVal) {\n          options.peakTypeLine = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.peakTypePoints', function (newVal) {\n          options.peakTypePoints = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.peakTypeLineFill', function (newVal) {\n          options.peakTypeLineFill = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.peakTypeLineWidth', function (newVal) {\n          options.peakTypeLineWidth = newVal;\n          renderPointsPanel();\n      });\n\n      scope.$watch('ctrl.panel.windRoseOptions.peakTypePointsRadius', function (newVal) {\n          options.peakTypePointsRadius = newVal;\n          renderPointsPanel();\n      });\n\n      //INIT\n      init();\n\n      elem.removeAttr('grafana-wind-rose');\n    }\n  };\n});\n"]}